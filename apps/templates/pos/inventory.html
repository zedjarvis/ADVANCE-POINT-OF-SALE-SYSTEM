{% extends 'pos/base.html' %}

{% block title %} INVENTORY | ADVANCE-POS {% endblock %}

{% block content %}

{% load static %}


<!--   INCLUDING THE BODY TAG -->
{% block bodytag %} {% include 'pos/includes/body_tag.html' %} {% endblock bodytag %}

<!--   INCLUDING THE PRELOADER -->
{% block preloader %} {% include 'pos/includes/preloader.html' %} {% endblock preloader %}

<!--   INCLUDING THE TOP NAV -->
{% block topnav %} {% include 'pos/includes/topnav.html' %} {% endblock topnav %}

<!--   INCLUDING THE SIDEBAR -->
{% block sidebar %} {% include 'pos/includes/sidebar.html' %} {% endblock sidebar %}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Inventory</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">items</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">ALL AVAILABLE ITEMS</h3>
                            <div class="col-lg-6 col-5 text-right">
                                <a href="#" class="btn btn-sm btn-outline-success" style="margin-bottom: 5px" id="refresh"><i class="fa fa-refresh"></i> Refresh</a>
                                <a href="#" class="btn btn-sm btn-success" style="margin-bottom: 5px" data-toggle="modal" data-target="#add_category">
                                    <i class="fa fa-plus"></i> Add Category</a>
                                <a href="#" class="btn btn-sm btn-success" style="margin-bottom: 5px" data-toggle="modal" data-target="#add_item_modal">
                                    <i class="fa fa-plus"></i> Add Item</a>

                            </div>
                        </div>
                        <!-- /.card-header -->
                        <div class="card-body">
                            <table id="example1" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>#ID</th>
                                        <th>ITEM</th>
                                        <th>DESCRIPTION</th>
                                        <th>QUANTITY</th>
                                        <th>PRICE</th>
                                        <th>VALUE</th>
                                        <th>STATUS</th>
                                        <th>CATEGORY</th>
                                        <th>ACTION</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in items %}
                                    <tr id='row{{item.id}}'>
                                        <td>{{item.id}}</td>
                                        <td><a href="#!">{{item.item_name}}</a></td>
                                        <td>{{item.description}}</td>
                                        <td>{{item.quantity}}</td>
                                        <td>{{item.unit_price}}</td>
                                        <td>{{item.value}}</td>
                                        <td><button class="btn btn-info">Avilable</button></td>
                                        <td>{{item.category}}</td>
                                        <td class="row">
                                            <button class="btn btn-outline-secondary" data-toggle="modal" data-target="#editItemModal{{item.id}}"><i class="fa fa-edit text-green"></i></button>
                                            <button onclick="deleteItem({{item.id}});" class="btn btn-outline-secondary"><i class="fa fa-trash text-red"></i></button>

                                        </td>
                                    </tr>
                                    <!-- EDIT ITEM MODAL -->
                                    <div class="modal fade" id="editItemModal{{item.id}}">
                                        <div class="modal-dialog modal-xl">
                                            <form id="item-edit-form" method="POST" action="{% url 'edit_item' item.id %}">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title">Edit <strong>{{item.item_name | upper}}</strong></h4>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                            <span aria-hidden="true">&times;</span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div style="padding: 5px;">
                                                            {% csrf_token %}
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <div class="form-group">
                                                                            <label class="form-control-label" for="category">Category</label>
                                                                            <input type="text" id="category" name="category" class="form-control"
                                                                                placeholder="category.." list="categories" value="{{item.category}}"
                                                                                required>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="item_id">ID</label>
                                                                    <input type="text" id="item_id" name="item_id" class="form-control" placeholder="id..."
                                                                        value="{{item.id}}" disabled required>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="item_name">Item Name</label>
                                                                    <input type="text" id="item_name" name="item_name" class="form-control"
                                                                        placeholder="Item Name..." value="{{item.item_name}}" required>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="purchase_price">Purchase Price</label>
                                                                    <input type="text" id="purchase_price" name="purchase_price" class="form-control"
                                                                        placeholder="Purchase Price..." value="{{item.purchase_price}}" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="item_price">Item Price</label>
                                                                    <input type="text" id="item_price" name="item_price" class="form-control"
                                                                        placeholder="Selling Price..." value="{{item.unit_price}}" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="quantity">Quantity</label>
                                                                    <input type="text" id="quantity" name="quantity" class="form-control"
                                                                        placeholder="Item Quantity..." value="{{item.quantity}}" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="reorder_level">Reorder Level</label>
                                                                    <input type="text" id="reorder_level" name="reorder_level" class="form-control"
                                                                        placeholder="Reorder Level..." value="{{item.reorder_level}}" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="reorder_quantity">Reorder Quantity</label>
                                                                    <input type="text" id="reorder_quantity" name="reorder_quantity" class="form-control"
                                                                        placeholder="Reorder Quantity..." value="{{item.reorder_quantity}}" required>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="location">Location</label>
                                                                    <input type="text" id="location" name="location" class="form-control"
                                                                        placeholder="Location..." value="{{item.location}}">
                                                                </div>

                                                            </div>
                                                            <div class="form-group">
                                                                <label class="form-control-label" for="description">Description</label>
                                                                <textarea class="form-control" name="description" id="description" cols="5" rows="3"
                                                                    placeholder="A short description of the item...">{{item.description}}</textarea>
                                                            </div>
                                                            <hr class="my-4">
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer justify-content-between">
                                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                                                        <button type="submit" class="btn btn-outline-primary"><i class="fa fa-plus"></i> Submit
                                                            Changes</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <!-- /.card-body -->
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
        <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
</div>

            <!-- ADD CATEGORY MODAL -->
            <div class="modal fade" id="add_category">
                <div class="modal-dialog modal-sm">
                    <form id="category-form">
                        {% csrf_token %}
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Add Category</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <input class="form-control" type="text" name="category_name" id="category_name" placeholder="Category Name">
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-primary"><i class="fa fa-plus"></i> Add Category</button>
                            </div>
                        </div>
                    </form>
                    <!-- ADD SHOP JQUERY SCRIPT -->
                    <script>
                        var category_form = document.getElementById("category-form");
                        category_form.addEventListener('submit', submitHandler);

                        function submitHandler(e) {
                            e.preventDefault();

                            $.ajax({
                                type: 'POST',
                                url: "{% url 'create_category' %}",
                                data: $('#category-form').serialize(),
                                dataType: 'json',
                                success: function (data) {
                                    category_form.reset()
                                    var Toast = Swal.mixin({
                                        toast: true,
                                        position: 'top-end',
                                        showConfirmButton: false,
                                        timer: 5000
                                    });

                                    Toast.fire({
                                        icon: 'success',
                                        title: `${data} Created.`
                                    })
                                },
                                error: function () {
                                    category_form.reset()
                                    var Toast = Swal.mixin({
                                        toast: true,
                                        position: 'top-end',
                                        showConfirmButton: true,
                                        timer: 5000
                                    });

                                    Toast.fire({
                                        icon: 'error',
                                        title: 'Something did not go right, please try again.'
                                    })
                                }
                            });
                        }


                    </script>
                </div>
            </div>


                            <!-- ADD ITEM MODAL -->
                            <div class="modal fade" id="add_item_modal">
                                <div class="modal-dialog modal-xl">
                                    <form id="item-form">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title">Add Item</h4>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <div style="padding: 5px;">
                                                    {% csrf_token %}
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <div class="form-group">
                                                                    <label class="form-control-label" for="category">Category</label>
                                                                    <input type="text" id="category" name="category" class="form-control"
                                                                        placeholder="Category...." list="categories" required>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="item_name">Item Name</label>
                                                            <input type="text" id="item_name" name="item_name" class="form-control"
                                                                placeholder="Item Name..." required>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="form-control-label" for="purchase_price">Purchase Price</label>
                                                            <input type="text" id="purchase_price" name="purchase_price" class="form-control"
                                                                placeholder="Purchase Price..." required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="item_price">Item Price</label>
                                                            <input type="text" id="item_price" name="item_price" class="form-control"
                                                                placeholder="Selling Price..." required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="quantity">Quantity</label>
                                                            <input type="text" id="quantity" name="quantity" class="form-control"
                                                                placeholder="Item Quantity..." required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="reorder_level">Reorder Level</label>
                                                            <input type="text" id="reorder_level" name="reorder_level" class="form-control"
                                                                placeholder="Reorder Level..." value="10" required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="reorder_quantity">Reorder Quantity</label>
                                                            <input type="text" id="reorder_quantity" name="reorder_quantity" class="form-control"
                                                                placeholder="Reorder Quantity..." required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="form-control-label" for="location">Location</label>
                                                            <input type="text" id="location" name="location" class="form-control"
                                                                placeholder="Location...">
                                                        </div>

                                                    </div>
                                                    <div class="form-group">
                                                        <label class="form-control-label" for="description">Description</label>
                                                        <textarea class="form-control" name="description" id="description" cols="5" rows="3"
                                                            placeholder="A short description of the item..."></textarea>
                                                    </div>
                                                    <datalist id='categories'>
                                                        {% if categories %}
                                                        {% for category in categories %}
                                                        <option value="{{category.category_name}}">
                                                            {% endfor %}
                                                            {% else %}
                                                        <option value="Please add categories first">
                                                            {% endif %}
                                                    </datalist>

                                                    <hr class="my-4">

                                                    <!-- ADD ITEM JQUERY SCRIPT -->
                                                    <script>
                                                        var item_form = document.getElementById("item-form");
                                                        item_form.addEventListener('submit', submitHandler);

                                                        function submitHandler(e) {
                                                            e.preventDefault();

                                                            $.ajax({
                                                                type: 'POST',
                                                                url: "{% url 'create_item' %}",
                                                                data: $('#item-form').serialize(),
                                                                dataType: 'json',
                                                                success: function (data) {
                                                                    item_form.reset()
                                                                    // append new item to table
                                                                    if (data.item) {
                                                                        appendToItemTable(data.item);
                                                                    }
                                                                    // sweet alert modal
                                                                    var Toast = Swal.mixin({
                                                                        toast: true,
                                                                        position: 'top-end',
                                                                        showConfirmButton: false,
                                                                        timer: 5000
                                                                    });

                                                                    Toast.fire({
                                                                        icon: 'success',
                                                                        title: 'Successfully Added Item.'
                                                                    })
                                                                },
                                                                error: function () {
                                                                    var Toast = Swal.mixin({
                                                                        toast: true,
                                                                        position: 'top-end',
                                                                        showConfirmButton: false,
                                                                        timer: 5000
                                                                    });

                                                                    Toast.fire({
                                                                        icon: 'error',
                                                                        title: 'Something did not go right, please try again.'
                                                                    })
                                                                }
                                                            });
                                                        }
                                                    </script>
                                                </div>
                                            </div>
                                            <div class="modal-footer justify-content-between">
                                                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                                                <button type="button" onclick="resetForm('item-form')" class="btn btn-outline-secondary">Clear
                                                    form</button>
                                                <button type="submit" class="btn btn-outline-primary"><i class="fa fa-plus"></i> Add Item</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

<!--    JQUERY FUNCTIONS TO ADD, EDIT AND DELETE ITEMS -->

{% block footer %} {% include 'pos/includes/footer.html' %} {% endblock footer %}

{% endblock content %}
